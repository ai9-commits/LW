<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>速度計算ツール</title>
<style>
  body { font-family: sans-serif; padding: 10px; max-width: 100%; margin: auto; overflow-x: hidden; word-break: break-word;}
  h2 { margin-top:0.3em; margin-bottom:0.75em;}
  h3 { margin-bottom:0.5em; margin-top:0.5em;}
  label { display: block; margin-top: 0.5em; word-break: break-word; }
  input { margin: 2px; }
  input#dA { width: 1.5em;}
  input#dB { width: 1.5em;}
  input#speedB { width: 6em;}
  button { font-size: large; margin-top: 1em; padding: 0.5em 1em;}
  table { border-collapse: collapse; margin-top: 0.5em; overflow-x: auto; max-width:100%;}
  th, td { border: 1px solid #999; padding: 2px; text-align: center; }
  td.diff { font-size: small; color: #ff1e1e; }
  th { background-color: #f0f0f0; }
  .result { margin-top: 1em; }
</style>
</head>
<body>
<h2>時間計算ツール0.06</h2>

<h3>元の所要時間</h3>
<label> <input type="number" id="dA" step="1" value="">d<input type="time" id="hmsA" step="1" value="00:00:00"></label>

<!--<h3>現在の所要時間か速度のどちらか入力</h3>-->
<h3>現在の所要時間</h3>
<label> <input type="number" id="dB" step="1" value="">d<input type="time" id="hmsB" step="1" value="00:00:00"></label>
<!--<label>速度: <input type="number" id="speedB" step="any" value=""></label>
<small>※所要時間と速度の両方を入力した場合、<br>&nbsp速度を優先して計算します</small>-->
<!--
<h3>任意追加速度</h3>
<label>速度: <input type="number" id="deltaCustom" step="any" value="0"></label>
-->
<label></label><button onclick="calculate()">計算する</button></label>

<div class="result">
  <p>現在の速度: <span id="displaySpeedB">---</span></p>
</div>

<table id="resultTable">
  <thead>
    <tr>
      <th>加速(%)</th>
      <th>所要時間</th>
      <th>短縮効果</th>
    </tr>
  </thead>
  <tbody>
    <!-- 計算結果がここに入る -->
  </tbody>
</table>

<script>
function timeToSeconds(d, hmsStr){
  const [h,m,s] = hmsStr.split(":").map(Number);
  return (d || 0)*86400 + h*3600 + m*60 + s;
}
// "hh:mm" 形式なら ":00" を追加
function normalizeTime(value) {
  if (/^\d{2}:\d{2}$/.test(value)) {
    return value + ":00";
  }
  return value;
}
// 1d 11:22:33形式で表示
function secondsToCompactDHMS(sec){
  const d = Math.floor(sec / 86400);
  sec %= 86400;
  const h = Math.floor(sec / 3600);
  sec %= 3600;
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60);
  return `${d}d ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function calculate(){
  const dA = parseInt(document.getElementById("dA").value) || 0;
  const hmsAraw = document.getElementById("hmsA").value || "00:00:00";
  const hmsA = normalizeTime(hmsAraw) || "00:00:00";
  const secondsA = timeToSeconds(dA, hmsA);

  const dB = parseInt(document.getElementById("dB").value) || 0;
  const hmsBraw = document.getElementById("hmsB").value;
  const hmsB = normalizeTime(hmsBraw) || "00:00:00";
  let secondsB = timeToSeconds(dB, hmsB);
  let speedB = parseFloat(document.getElementById("speedB").value) || null;
  const speedA = 100;
  //const deltaCustom = parseFloat(document.getElementById("deltaCustom").value) || 0;

  // Bの所要時間優先
  if(speedB && speedB > 0){
    secondsB = secondsA * (speedA / speedB);
  } else if(dB !== "" && hmsB){
    secondsB = timeToSeconds(parseInt(dB), hmsB);
    if(secondsB <= 0){ alert("現在の所要時間は0秒以上にしてください"); return; }
    speedB = speedA * (secondsA / secondsB);
  } else if(speedB && speedB > 0){
    secondsB = secondsA * (speedA / speedB);
  } else {
  //  alert("Bの所要時間か速度のどちらかを入力してください");
    alert("現在の所要時間を入力してください");
    return;
  }

  // Bの速度表示
  document.getElementById("displaySpeedB").textContent = speedB.toFixed(2);

  // 足す速度計算
  //const deltas = [20,25,50,60, deltaCustom];
  //const deltaLabels = ["20","25","50","60","任意"];
  const deltas = [20,25,50,60];
  const deltaLabels = ["20","25","50","60"];

  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = ""; // 初期化

  deltas.forEach((delta,i)=>{
    const newTime = secondsB * (speedB / (speedB + delta));
    const diff = secondsB - newTime;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${deltaLabels[i]}</td>
      <td>${secondsToCompactDHMS(newTime)}</td>
      <td class="diff">${secondsToCompactDHMS(diff)}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>
<footer style="
    margin-top:2em;
    max-width: 100%;
    padding:1em;
    font-size:0.55em;
    color:#555;
    border-top:1px solid #ccc;
    text-align:center;
    word-break: break-word;
">
  <p>作成: とうふゃ#1611</p>
  <p>文責: 個人作成ツールのため、計算結果の正確性は保証しません</p>
  <p>使用上の注意: 本ツールは簡易計算用です。仕様変更や追加要素によって実際の値との差が発生する可能性があります</p>
</footer>
</body>
</html>
